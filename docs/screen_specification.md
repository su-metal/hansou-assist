# 画面仕様書：搬送アシスト

---

## 1. 画面一覧

| 画面ID | 画面名 | パス | アクセス権限 | 説明 |
|--------|-------|------|------------|------|
| SCR-001 | ログイン | `/login` | 全員 | メール + パスワード認証 |
| SCR-002 | スケジュール一覧 | `/schedule` | 全ロール | ★メイン画面。施設・ホール別の予定一覧 |
| SCR-003 | カレンダービュー | `/calendar` | 全ロール | 日付別の全施設スケジュール |
| SCR-004 | スケジュール詳細 | `/schedule/[id]` | 全ロール | ホール単位の詳細情報 |
| SCR-005 | スケジュール登録/編集 | `/schedule/edit` | admin, dispatcher | 手動での予定登録・編集 |
| SCR-006 | OCR撮影 | `/camera` | admin, dispatcher | 紙資料の撮影 → AI解析 |
| SCR-007 | OCR結果確認 | `/camera/confirm` | admin, dispatcher | 解析結果のプレビュー・修正 |
| SCR-008 | AIチャット | `/chat` | 全ロール | AI質問応答 |
| SCR-009 | ナレッジ一覧 | `/knowledge` | 全ロール | 施設別マニュアル一覧 |
| SCR-010 | ナレッジ詳細/編集 | `/knowledge/[id]` | 全ロール（編集はadmin, dispatcher, driver） | 個別記事の閲覧・編集 |
| SCR-011 | 管理者：施設管理 | `/admin/facilities` | admin | 施設・ホールのCRUD |
| SCR-012 | 管理者：ユーザー管理 | `/admin/users` | admin | ユーザー招待・ロール管理 |
| SCR-013 | 管理者：休業日管理 | `/admin/closed-days` | admin | 友引以外の休業日登録 |

---

## 2. 画面詳細

### SCR-001: ログイン画面

| 項目 | 内容 |
|------|------|
| **概要** | メールアドレスとパスワードでログイン |
| **遷移元** | 未認証状態で全画面 |
| **遷移先** | SCR-002（スケジュール一覧） |

**表示要素：**
- アプリロゴ + アプリ名「搬送アシスト」
- メールアドレス入力フィールド
- パスワード入力フィールド（表示/非表示切替）
- 「ログイン」ボタン
- 「パスワードを忘れた方」リンク

**バリデーション：**
- メール：必須、メール形式チェック
- パスワード：必須、8文字以上
- 認証失敗時：「メールアドレスまたはパスワードが正しくありません」

---

### SCR-002: スケジュール一覧（★メイン画面）

| 項目 | 内容 |
|------|------|
| **概要** | 施設・ホール別の空き状況を一覧表示 |
| **初期状態** | 「今日」の日付でフィルター済み |
| **更新** | Supabase Realtimeで自動更新 |

**ヘッダー部：**
- 日付セレクタ：「←」今日 / 明日 / 今週「→」
- 六曜表示：選択日の六曜ラベル（友引の場合は赤色 +「葬儀なし」）
- フィルターボタン：エリア・施設タイプで絞り込み
- 最終同期時刻の表示

**メインコンテンツ：**
- 施設ごとにカード形式で表示
  - カード内にホール一覧（ステータス色分け付き）

```
┌─────────────────────────────────────┐
│ 🏛 セレモニー会館田原         📞 電話 │
│───────────────────────────────────── │
│  🟢 第1ホール  空き                    │
│  🔴 第2ホール  田中家 葬儀 11:30      │
│  🟡 花の間    準備中                  │
└─────────────────────────────────────┘
┌─────────────────────────────────────┐
│ 🏛 やすらぎ苑                 📞 電話 │
│───────────────────────────────────── │
│  🟢 大ホール   空き                   │
│  🟢 小ホール   空き                   │
└─────────────────────────────────────┘
```

**ステータス色：**
- 🟢 緑：空き（available）
- 🔴 赤：使用中（occupied）
- 🟡 黄：準備中（preparing）
- ⬜ グレー：不明

**操作：**
- ホールタップ → SCR-004（詳細）に遷移
- 「+」ボタン（admin/dispatcher） → SCR-005（登録）に遷移
- プルダウンリフレッシュで手動リロード

---

### SCR-003: カレンダービュー

| 項目 | 内容 |
|------|------|
| **概要** | 週間カレンダーで全施設の予定を俯瞰 |
| **切替** | 週表示（デフォルト）/ 月表示 |

**表示：**
- 横軸：日付（六曜ラベル付き）
- 縦軸：施設（会館名）
- セル内：ホールごとのステータスアイコン
- 友引の日：列全体をグレーアウト +「葬儀なし」表示
- セルタップ → 該当日のSCR-002にジャンプ

---

### SCR-004: スケジュール詳細

| 項目 | 内容 |
|------|------|
| **概要** | 1ホールの予定詳細を表示 |
| **遷移元** | SCR-002 からホールタップ |

**表示項目：**
- 会館名 → ホール名
- 日付 + 六曜
- ステータス（大きめアイコン）
- 区分（葬儀/通夜）
- 喪家名（登録されている場合）
- 開式時間
- 控室有無
- 登録者名
- 登録方法（OCR/手動）
- 最終更新日時

**操作：**
- 「編集」ボタン（admin/dispatcher） → SCR-005
- 「電話する」ボタン → 電話アプリ起動
- 「戻る」→ SCR-002

---

### SCR-005: スケジュール登録/編集

| 項目 | 内容 |
|------|------|
| **概要** | スケジュールの手動登録・編集フォーム |
| **権限** | admin, dispatcher のみ |

**入力フィールド：**

| フィールド | 型 | 必須 | バリデーション |
|-----------|-----|:---:|------------|
| 施設選択 | セレクトボックス | ✓ | 有効な施設のみ |
| ホール選択 | セレクトボックス | ✓ | 選択施設に属するホール |
| 日付 | 日付ピッカー | ✓ | 友引の場合は警告表示 |
| 区分 | ラジオ（葬儀/通夜） | ✓ | - |
| ステータス | セレクト（空き/使用中/準備中） | ✓ | - |
| 喪家名 | テキスト | - | 20文字以内 |
| 開式時間 | 時刻ピッカー | - | HH:MM形式 |

**操作：**
- 「保存」→ DB更新 → SCR-002へ戻る
- 「キャンセル」→ 確認ダイアログ → SCR-002へ戻る
- 友引の日を選択した場合：「この日は友引です。葬儀・通夜は通常行われません。登録しますか？」確認表示

---

### SCR-006: OCR撮影画面

| 項目 | 内容 |
|------|------|
| **概要** | スマホカメラで紙資料を撮影 |
| **権限** | admin, dispatcher |

**表示要素：**
- カメラプレビュー（全画面）
- 撮影ガイド枠（A4サイズのガイドライン）
- 「撮影」ボタン（中央下）
- フラッシュ切替ボタン
- ギャラリーから選択ボタン

**操作：**
- 撮影 → ローディング表示 → SCR-007（確認画面）へ遷移
- 撮影失敗時：「もう一度撮影してください」メッセージ

---

### SCR-007: OCR結果確認画面

| 項目 | 内容 |
|------|------|
| **概要** | AI解析結果のプレビューと修正 |
| **遷移元** | SCR-006 |

**表示：**
- 上部：撮影した画像のサムネイル
- 下部：解析結果の一覧（編集可能なフォーム形式）

```
📷 撮影画像プレビュー
──────────────────
解析結果 (3件):

✅ セレモニー会館田原 - 第1ホール
   2/18  葬儀  田中家  11:30  使用中  [編集]

✅ セレモニー会館田原 - 第2ホール
   2/18  空き                          [編集]

⚠️ セレモニー会館田原 - 花の間
   2/18  通夜  ????家  18:00  使用中  [編集]
   ※ 喪家名が読み取れませんでした

[すべて登録]  [やり直し]
```

- ⚠️ マーク：AI確信度が低い項目（手動確認推奨）
- 各行の「編集」→ インライン編集モード
- 「すべて登録」→ DB一括保存 → SCR-002へ
- 「やり直し」→ SCR-006へ戻る

---

### SCR-008: AIチャット画面

| 項目 | 内容 |
|------|------|
| **概要** | AIに自然言語で質問 |
| **全ロール利用可** | |

**表示：**
- チャット形式のメッセージ一覧
- 入力欄（テキスト + マイクボタン）
- 音声読み上げON/OFFトグル

**機能：**
- テキスト入力 → Gemini APIに送信 → 回答表示
- マイクボタン → 音声認識 → テキスト変換 → 送信
- 回答に「出典」リンク（スケジュールDB or ナレッジDB）
- 会話履歴：直近10件を保持
- クイックアクション候補：「今日空いてるホールは？」「明日の予定は？」

---

### SCR-009〜010: ナレッジ一覧/詳細

- 施設別のマニュアル記事一覧
- カテゴリフィルター（搬入手順・宗派マナー・その他）
- 検索バー（タイトル・本文の全文検索）
- Markdown形式の本文表示
- 画像の添付・表示
- 全ロールが編集可能（Wiki形式）

---

### SCR-011〜013: 管理者画面

**施設管理（SCR-011）：**
- 施設の追加・編集・無効化
- 施設内のホール追加・編集・無効化
- ホールの収容人数・控室有無の設定

**ユーザー管理（SCR-012）：**
- 招待リンクの発行（メールアドレス指定）
- ロール変更（admin / dispatcher / driver）
- アカウントの無効化

**休業日管理（SCR-013）：**
- 友引以外の休業日を手動登録
- 対象：全施設共通 or 特定施設
- カレンダー形式で一覧表示

---

## 3. ボトムナビゲーション

| 位置 | アイコン | ラベル | 遷移先 | バッジ |
|:---:|---------|-------|--------|-------|
| 1 | 📋 | 一覧 | SCR-002 | 更新件数 |
| 2 | 📷 | カメラ | SCR-006 | - |
| 3 | 💬 | AI | SCR-008 | - |
| 4 | 📚 | 情報 | SCR-009 | - |

- admin ロールの場合のみ、右上にギアアイコン（SCR-011〜013へのメニュー）を表示
- driverロールの場合、カメラタブは非表示

---

## 4. ダークモード対応

| 要素 | ライトモード | ダークモード |
|------|------------|------------|
| 背景 | #FFFFFF | #1A1A2E |
| カード | #F8F9FA | #16213E |
| テキスト | #333333 | #E8E8E8 |
| ステータス緑 | #22C55E | #4ADE80 |
| ステータス赤 | #EF4444 | #F87171 |
| ステータス黄 | #EAB308 | #FACC15 |

- デフォルト：ダークモード（深夜利用が多いため）
- システム設定に連動 or 手動切替
